{
    "action.email": "0",
    "action.email.includeEntities": "0",
    "action.itsi_event_generator": "1",
    "action.itsi_event_generator.param.description": "Group: %alert_groupingid% triggered at %alert_time%",
    "action.itsi_event_generator.param.entity_lookup_field": "entity_name",
    "action.itsi_event_generator.param.event_identifier_fields": "groupingid",
    "action.itsi_event_generator.param.itsi_instruction": "%itsi_instruction%",
    "action.itsi_event_generator.param.meta_data": "{}",
    "action.itsi_event_generator.param.search_type": "basic",
    "action.itsi_event_generator.param.title": "%itsiNotableTitle%",
    "action.rss": "0",
    "action.script": "0",
    "actions": "itsi_event_generator",
    "alert.digest_mode": "1",
    "alert.expires": "24h",
    "alert.severity": "3",
    "alert.suppress": "0",
    "alert.track": "0",
    "alert_comparator": "greater than",
    "alert_threshold": "0",
    "alert_type": "number of events",
    "allow_skew": "5m",
    "auto_summarize": "0",
    "cron_schedule": "*/1 * * * *",
    "defer_scheduled_searchable_idxc": "0",
    "disabled": "0",
    "dispatch.allow_partial_results": "1",
    "dispatch.auto_cancel": "0",
    "dispatch.auto_pause": "0",
    "dispatch.buckets": "0",
    "dispatch.earliest_time": "-12h",
    "dispatch.latest_time": "now",
    "dispatch.lookups": "1",
    "dispatch.max_count": "500000",
    "dispatch.max_time": "0",
    "dispatch.rate_limit_retry": "0",
    "dispatch.reduce_freq": "10",
    "dispatch.rt_backfill": "0",
    "dispatch.sample_ratio": "1",
    "dispatch.spawn_process": "1",
    "dispatch.time_format": "%FT%T.%Q%:z",
    "dispatch.ttl": "2p",
    "dispatchAs": "owner",
    "eai:acl": {
        "app": "itsi",
        "can_change_perms": "1",
        "can_list": "1",
        "can_share_app": "1",
        "can_share_global": "1",
        "can_share_user": "1",
        "can_write": "1",
        "modifiable": "1",
        "owner": "admin",
        "perms": {
            "delete": [
                "itoa_admin",
                "itoa_team_admin"
            ],
            "read": [
                "*"
            ],
            "write": [
                "itoa_admin",
                "itoa_team_admin"
            ]
        },
        "removable": "1",
        "sharing": "global"
    },
    "is_scheduled": "1",
    "is_visible": "1",
    "key": "Episode Monitoring - Trigger Major Minor Alerts",
    "max_concurrent": "1",
    "name": "Episode Monitoring - Trigger Major Minor Alerts",
    "next_scheduled_time": "2025-05-06 13:28:22 UTC",
    "precalculate_required_fields_for_alerts": "1",
    "qualifiedSearch": "search index=itsi_grouped_alerts AND (source=\"Service Monitoring*\" OR (source=\"Episode Monitoring*\" AND send_alert=*)) \n| `filter_to_open_episodes`\n| fillnull alert_group value=\"Nu11\"\n| fillnull send_alert value=\"not_sent\"\n``` find out the current streak length at the given state ```\n```| rangemap field=severity major=5-999 minor=3-4 default=ok\n| rename range as impact```\n| eval groupingid=coalesce(alert_groupingid, groupingid)\n```| sort - _time\n| streamstats count as streak_len by groupingid impact  reset_on_change=true\n| eventstats max(streak_len) as streak_len, min(_time) as streak_start by groupingid impact```\n\n| stats latest(streak_length) as current_streak_length, latest(streak_start) as current_streak_start,\n        latest(streak_length_deg) as current_streak_length_deg, latest(streak_start_deg) as current_streak_start_deg,\n        latest(impact) as current_impact\n        latest(severity) as alert_level, latest(source) as alert_source,\n        max(eval(if(send_alert==\"minor\", _time, -1))) as minor_alert_time, max(eval(coalesce(minor_alerts, 0))) as minor_alerts, \n        max(eval(if(send_alert==\"major\", _time, -1))) as major_alert_time, max(eval(coalesce(major_alerts, 0))) as major_alerts, \n        latest(episode_contact*) as episode_contact*,  latest(xmatters*) as xmatters*, \n        latest(suppress_period) as suppress_period, latest(threshold) as threshold, \n\n    by groupingid, itsi_policy_id, entity_title, serviceid, kpiid, alert_group, itsi_group_id\n``` When do we alert?  ```\n| eval minor_alerts=if( current_streak_length >= threshold AND alert_level > `itsi_sev_normal` AND (minor_alert_time==-1 OR minor_alert_time+suppress_period*60 < now() ), minor_alerts+1, 0 )\n| eval major_alerts=if( current_streak_length >= threshold AND alert_level > `itsi_sev_medium` AND (major_alert_time==-1 OR major_alert_time+suppress_period*60 < now() ), major_alerts+1, 0 )\n| eval send_alert=case(major_alerts>0, \"major\", minor_alerts>0, \"minor\")\n| where isnotnull(send_alert)\n| eval severity=alert_level, alert_groupingid=groupingid, groupingid=\"Alert Triggered\", alert_time=strftime(now(), \"%F %T\"), nths=mvappend(\"-th\", \"st\", \"nd\", \"rd\", \"th\"), \n       detail=printf(\" impacting the last %d event(s) since %s.\", current_streak_length, strftime(current_streak_start, \"%T %F\")),\n       itsiNotableTitle=printf(\"Triggering %s alert, %s\",  \n                       case(send_alert==\"major\", printf(\"%d%s MAJOR\", major_alerts, mvindex(nths, min(4, major_alerts) )), \n                            send_alert==\"minor\", printf(\"%d%s MINOR\", minor_alerts, mvindex(nths, min(4, minor_alerts) )),\n                            1==1, \"No Alert\"), detail)\n| fields - suppress_period, nths\n| eval entity_name=entity_title\n| eval tmp_serviceid=serviceid,  tmp_entity_title=entity_title\n | `apply_entity_lookup(entity_name)`| eval serviceid=coalesce(serviceid, tmp_serviceid), entity_title=coalesce(entity_title, tmp_entity_title)",
    "realtime_schedule": "1",
    "restart_on_searchpeer_add": "1",
    "run_n_times": "0",
    "run_on_startup": "0",
    "schedule_as": "auto",
    "schedule_priority": "default",
    "schedule_window": "auto",
    "search": "index=itsi_grouped_alerts AND (source=\"Service Monitoring*\" OR (source=\"Episode Monitoring*\" AND send_alert=*)) \n| `filter_to_open_episodes`\n| fillnull alert_group value=\"Nu11\"\n| fillnull send_alert value=\"not_sent\"\n``` find out the current streak length at the given state ```\n```| rangemap field=severity major=5-999 minor=3-4 default=ok\n| rename range as impact```\n| eval groupingid=coalesce(alert_groupingid, groupingid)\n```| sort - _time\n| streamstats count as streak_len by groupingid impact  reset_on_change=true\n| eventstats max(streak_len) as streak_len, min(_time) as streak_start by groupingid impact```\n\n| stats latest(streak_length) as current_streak_length, latest(streak_start) as current_streak_start,\n        latest(streak_length_deg) as current_streak_length_deg, latest(streak_start_deg) as current_streak_start_deg,\n        latest(impact) as current_impact\n        latest(severity) as alert_level, latest(source) as alert_source,\n        max(eval(if(send_alert==\"minor\", _time, -1))) as minor_alert_time, max(eval(coalesce(minor_alerts, 0))) as minor_alerts, \n        max(eval(if(send_alert==\"major\", _time, -1))) as major_alert_time, max(eval(coalesce(major_alerts, 0))) as major_alerts, \n        latest(episode_contact*) as episode_contact*,  latest(xmatters*) as xmatters*, \n        latest(suppress_period) as suppress_period, latest(threshold) as threshold, \n\n    by groupingid, itsi_policy_id, entity_title, serviceid, kpiid, alert_group, itsi_group_id\n``` When do we alert?  ```\n| eval minor_alerts=if( current_streak_length >= threshold AND alert_level > `itsi_sev_normal` AND (minor_alert_time==-1 OR minor_alert_time+suppress_period*60 < now() ), minor_alerts+1, 0 )\n| eval major_alerts=if( current_streak_length >= threshold AND alert_level > `itsi_sev_medium` AND (major_alert_time==-1 OR major_alert_time+suppress_period*60 < now() ), major_alerts+1, 0 )\n| eval send_alert=case(major_alerts>0, \"major\", minor_alerts>0, \"minor\")\n| where isnotnull(send_alert)\n| eval severity=alert_level, alert_groupingid=groupingid, groupingid=\"Alert Triggered\", alert_time=strftime(now(), \"%F %T\"), nths=mvappend(\"-th\", \"st\", \"nd\", \"rd\", \"th\"), \n       detail=printf(\" impacting the last %d event(s) since %s.\", current_streak_length, strftime(current_streak_start, \"%T %F\")),\n       itsiNotableTitle=printf(\"Triggering %s alert, %s\",  \n                       case(send_alert==\"major\", printf(\"%d%s MAJOR\", major_alerts, mvindex(nths, min(4, major_alerts) )), \n                            send_alert==\"minor\", printf(\"%d%s MINOR\", minor_alerts, mvindex(nths, min(4, minor_alerts) )),\n                            1==1, \"No Alert\"), detail)\n| fields - suppress_period, nths\n| eval entity_name=entity_title\n| eval tmp_serviceid=serviceid,  tmp_entity_title=entity_title\n | `apply_entity_lookup(entity_name)`| eval serviceid=coalesce(serviceid, tmp_serviceid), entity_title=coalesce(entity_title, tmp_entity_title)",
    "sid": "Episode Monitoring - Trigger Major Minor Alerts",
    "skip_scheduled_realtime_idxc": "0",
    "version": "0.0.41"
}